<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Clifford – Music Events</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f4f4f4;
    }
    h1 {
      color: #2c3e50;
      text-align: center;
    }
    form {
      background: #fff;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    input, select, textarea {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
    button {
      margin-top: 15px;
      padding: 10px 20px;
      background: #27ae60;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background: #219150;
    }
    .event {
      background: white;
      padding: 10px;
      margin-bottom: 10px;
      border-left: 4px solid #2980b9;
      border-radius: 4px;
    }
    .event span {
      display: block;
      color: #555;
      font-size: 0.9em;
    }
  </style>
</head>
<body>
  <!-- 
    Clifford – Music Events
    This HTML document contains a form to add music events with the following fields:
      - Event title
      - Date and time (future events only)
      - Location
      - Music style (expanded list including Jam session)
      - Optional description

    Upon submitting the form, the data is validated (date must not be in the past),
    then saved to the Firestore database (Firebase).

    Only upcoming events are displayed on the page, sorted by date and time.

    Technologies used:
      - HTML + CSS for layout and styling
      - JavaScript module with Firebase SDK for Firestore communication
      - Firebase Firestore to store and fetch events

    This code currently does not support user login or event editing by users.
  -->

  <h1>Clifford – Music Events</h1>

  <form id="eventForm">
    <label>Event Title:
      <input type="text" id="title" required />
    </label>
    <label>Date and Time:
      <input type="datetime-local" id="datetime" required />
    </label>
    <label>Location:
      <input type="text" id="location" required />
    </label>
    <label>Music Style:
      <select id="style" required>
        <option value="">-- Select style --</option>
        <option value="Jazz">Jazz</option>
        <option value="Rock">Rock</option>
        <option value="Classical">Classical</option>
        <option value="Electronic">Electronic</option>
        <option value="Blues">Blues</option>
        <option value="Folk">Folk</option>
        <option value="Hip-Hop">Hip-Hop</option>
        <option value="Pop">Pop</option>
        <option value="Reggae">Reggae</option>
        <option value="Metal">Metal</option>
        <option value="R&B">R&B</option>
        <option value="Country">Country</option>
        <option value="Latino">Latino</option>
        <option value="World">World</option>
        <option value="Jam session">Jam session</option>
        <option value="Other">Other</option>
      </select>
    </label>
    <label>Description (optional):
      <textarea id="description"></textarea>
    </label>
    <button type="submit">Add Event</button>
  </form>

  <div id="eventList"></div>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, query, orderBy, where } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBylr8Qgxzw263rInUmln4AYMpibm1t43o",
      authDomain: "clifford-146ae.firebaseapp.com",
      projectId: "clifford-146ae",
      storageBucket: "clifford-146ae.appspot.com",
      messagingSenderId: "655375890963",
      appId: "1:655375890963:web:0153ed600a917c222c9de6",
      measurementId: "G-LH3WS88L5W"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const form = document.getElementById('eventForm');
    const eventList = document.getElementById('eventList');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const now = new Date();
      const datetimeInput = new Date(document.getElementById('datetime').value);

      if (datetimeInput < now) {
        alert("You can't add an event in the past.");
        return;
      }

      const newEvent = {
        title: document.getElementById('title').value,
        datetime: datetimeInput.toISOString(),
        location: document.getElementById('location').value,
        style: document.getElementById('style').value,
        description: document.getElementById('description').value,
        createdAt: new Date().toISOString()
      };

      await addDoc(collection(db, "events"), newEvent);
      form.reset();
      loadEvents();
    });

    async function loadEvents() {
      eventList.innerHTML = "";
      const nowISO = new Date().toISOString();
      const q = query(collection(db, "events"), where("datetime", ">=", nowISO), orderBy("datetime"));
      const querySnapshot = await getDocs(q);

      querySnapshot.forEach(doc => {
        const data = doc.data();
        const div = document.createElement('div');
        div.className = 'event';
        div.innerHTML = `
          <strong>${data.title}</strong>
          <span>${new Date(data.datetime).toLocaleString()}</span>
          <span>${data.location}</span>
          <span>${data.style}</span>
          ${data.description ? `<span>${data.description}</span>` : ''}
        `;
        eventList.appendChild(div);
      });
    }

    loadEvents();
  </script>
</body>
</html>
